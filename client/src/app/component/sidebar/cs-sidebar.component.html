<aside class="cs-sidebar">
  <div class="cs-sidebar__brand">
    <ng-container *ngIf="brand; else customBrand">{{ brand }}</ng-container>
    <ng-template #customBrand>
      <ng-content select="[csSidebarBrand]" />
    </ng-template>
  </div>

  <nav class="cs-sidebar__nav">
    <section class="cs-sidebar__section" *ngFor="let section of sections; let sectionIndex = index">
      <h3 class="cs-sidebar__section-title" *ngIf="section.label">{{ section.label }}</h3>

      <ul class="cs-sidebar__items">
        <li class="cs-sidebar__item" *ngFor="let item of section.items; let itemIndex = index">
          <ng-container *ngIf="!(item.children?.length); else hasChildren">
            <a
              *ngIf="item.route; else externalOrAction"
              class="cs-sidebar__link"
              [routerLink]="item.route"
              (click)="handleClick($event, item)"
            >
              <i *ngIf="item.icon" class="cs-sidebar__icon" [ngClass]="['fa-solid', item.icon]" aria-hidden="true"></i>
              <span>{{ item.label }}</span>
            </a>

            <ng-template #externalOrAction>
              <a
                *ngIf="item.externalUrl; else emitOnly"
                class="cs-sidebar__link"
                [href]="item.externalUrl"
                target="_blank"
                rel="noopener noreferrer"
                (click)="handleClick($event, item)"
              >
                <i *ngIf="item.icon" class="cs-sidebar__icon" [ngClass]="['fa-solid', item.icon]" aria-hidden="true"></i>
                <span>{{ item.label }}</span>
              </a>

              <ng-template #emitOnly>
                <button
                  class="cs-sidebar__link cs-sidebar__link--action"
                  type="button"
                  (click)="handleClick($event, item)"
                >
                  <i *ngIf="item.icon" class="cs-sidebar__icon" [ngClass]="['fa-solid', item.icon]" aria-hidden="true"></i>
                  <span>{{ item.label }}</span>
                </button>
              </ng-template>
            </ng-template>
          </ng-container>

          <ng-template #hasChildren>
            <button
              type="button"
              class="cs-sidebar__group-header"
              (click)="toggleGroup(sectionIndex, itemIndex, item)"
              [attr.aria-expanded]="isGroupExpanded(sectionIndex, itemIndex, item)"
            >
              <i *ngIf="item.icon" class="cs-sidebar__icon" [ngClass]="['fa-solid', item.icon]" aria-hidden="true"></i>
              <span class="cs-sidebar__group-label">{{ item.label }}</span>
              <i
                class="cs-sidebar__chevron fa-solid"
                [ngClass]="{
                  'fa-chevron-down': !isGroupExpanded(sectionIndex, itemIndex, item),
                  'fa-chevron-up': isGroupExpanded(sectionIndex, itemIndex, item)
                }"
                aria-hidden="true"
              ></i>
            </button>

            <ul
              class="cs-sidebar__subitems"
              *ngIf="isGroupExpanded(sectionIndex, itemIndex, item)"
            >
              <li class="cs-sidebar__subitem" *ngFor="let child of item.children">
                <a
                  *ngIf="child.route; else childEmitOnly"
                  class="cs-sidebar__sublink"
                  [routerLink]="child.route"
                  (click)="handleClick($event, child)"
                >
                  <span>{{ child.label }}</span>
                </a>

                <ng-template #childEmitOnly>
                  <button
                    class="cs-sidebar__sublink cs-sidebar__sublink--action"
                    type="button"
                    (click)="handleClick($event, child)"
                  >
                    <span>{{ child.label }}</span>
                  </button>
                </ng-template>
              </li>
            </ul>
          </ng-template>
        </li>
      </ul>
    </section>
  </nav>

  <div class="cs-sidebar__footer">
    <ng-content select="[csSidebarFooter]" />
  </div>
</aside>
